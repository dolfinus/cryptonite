# **Задачи обеспечения информационной безопасности с использованием СКЗИ**

В настоящий момент вслед за развитием электронного документооборота,
широкодоступных сетевых служб, обмена информацией через сети передачи данных
общего пользования все более широкое развитие получают средства криптографической
защиты информации.
_Средства криптографической защиты информации (СКЗИ) – это совокупность
программных и технических элементов систем обработки данных, способных
функционировать самостоятельно или в составе других систем и осуществлять
криптографическое преобразование информации для обеспечения ее безопасности_.
При этом стоит отметить замечательную особенность СКЗИ, которая состоит в том, что
применительно к некоторым направлениям (например, защищенная электронная почта и
виртуальные частные сети) у средств криптографической защиты информации просто не
существует альтернатив.
Среди основных задач, непосредственно связанных с обеспечением
информационной безопасности любой системы, базы данных или сети передачи
информации, решаемых при помощи СКЗИ, можно выделить следующие:
* создание и использование носителей ключевой информации;
* шифрование данных, хранимых в базе данных или в электронном виде на
различных носителях информации;
* электронная цифровая подпись и связанные с ней виды шифрования, в
частности, проверка авторства;
* криптографические интерфейсы;
* задачи идентификации и аутентификации.
Шифрование, производимое средствами криптографической защиты информации,
может производиться с применением одного или нескольких криптографических методов
защиты информации:
* программные, которые состоят в реализацию одного или нескольких
криптографических алгоритмов на языке программирования высокого или низкого
уровня, в виде модулей, отдельных библиотек или выделенных программ с функцией
криптографической защиты;
* аппаратные, которые представляют собой реализацию криптографических
алгоритмов или их отдельные участки в микросхемах, процессорах и специализированных
блоках (системы встроенной защиты) и аппаратных модулях (системы наложенной


защиты), совмещенные со средствами вычислительной техники или встраиваемые в
автоматизированные системы;
* программно-аппаратные представляют собой комплексы, состоящие из
взаимосвязанной программной и аппаратной части с функциями криптографической
защиты.
Например, средство криптографической защиты информации М-506А-XP – это
программно-аппаратный комплекс, предназначенный для защиты информации в
локальных вычислительных сетях, функционирующих под управлением ОС MS Windows
2000/XP/2003 шифрует сетевой трафик между всеми рабочими станциями и серверами
сети, которые участвуют в защищенном взаимодействии.
Шифрование выполняется методом, определенном в ГОСТ 28147-89, в режиме
гаммирования на специальных сессионных ключах, которые генерируются при каждом
соединении клиента с сервером безопасности.
Защита информации от несанкционированного доступа
СКЗИ М-506А-XP реализовано на основе системы Secret Net 5.0, поэтому оно
содержит все механизмы защиты информации от несанкционированного доступа,
средства управления и регистрации, которые есть в этом продукте:
*^ доверенная загрузка (защита от загрузки с внешних носителей);
*^ идентификация и аутентификация пользователей;
*^ разграничение доступа к устройствам;
*^ контроль печати конфиденциальной информации;
*^ полномочное управление доступом;
*^ контроль целостности программ и данных;
*^ гарантированное уничтожение данных;
*^ контроль аппаратной конфигурации компьютера;
*^ функция электронной цифровой подписи файлов;
*^ шифрование файлов
СКЗИ М-506А-XP позволяет шифровать файлы на локальных ресурсах.
Шифрование осуществляется методом, определенным в ГОСТ 28147-89, в режиме
гаммирования.

## Управление безопасностью
СКЗИ М-506А-XP имеет архитектуру "клиент-сервер". Использование этой
архитектуры позволяет централизованно управлять безопасностью огромного количества
компьютеров, принимать и обрабатывать информацию о происходящих событиях:
* регистрация событий рабочих станций;
* контроль действий сотрудников и администраторов;
* механизм отчетов.

# **СКЗИ на персональном компьютере**

Анализ технологий шифрования данных на жестких дисках и съемных носителях
К технологиям шифрования относятся:
 программное шифрование;
 аппаратное шифрование;
 шифрование до загрузки операционной системы;
 шифрование после загрузки операционной системы;
 шифрование на уровне приложений;
 шифрование на уровне файлов и папок;
 шифрование всего тома;
 шифрование для каждого пользователя;
 шифрование компьютера.
Шифрование можно осуществить множеством способов. Например, шифрование
можно выполнять на различных уровнях или с помощью сложных шаблонов,
содержащихся в уникальных алгоритмах. При рассмотрении ключей шифрования часто
анализируется длина ключа, но вопросы получения, хранения и использования ключей
зачастую являются гораздо более важными. Вопросы хранения и защиты ключей
шифрования редко подробно обсуждаются в технической документации, но эти вопросы
крайне важны для понимания того, что обычно является самым слабым местом
технологии шифрования.
Оптимальный алгоритм шифрования разработан и реализован таким образом,
чтобы единственный способ взлома шифра заключался в подборе единственного
правильного ключа из огромного пространства ключей, которое представляет собой
диапазон значений, которые может принимать ключ. Этот тип атаки называется методом
перебора.
Алгоритмы с использованием симметричных ключей используют, как правило,
пространство ключей от 40 до 512 бит. Количество возможных значений ключа равно
максимальному численному значению, которое можно выразить с помощью данного


количества бит. 40 бит дают максимальное численное значение, равное 1 099 511 627 775
(2^40 - 1), довольно большое число, хотя современные компьютеры могут с легкостью
перебрать все возможные значения 40-разрядного пространства ключей для расшифровки
данных. Однако каждый бит, добавляемый к пространству ключей, удваивает количество
возможных ключей, поэтому 41-разрядное пространство ключей содержит 2 199 023 255
552 возможных ключей. Увеличение пространства ключей быстро увеличивает
количество возможных ключей до такого значения, при котором атаки методом перебора
становятся неэффективными при использовании современного оборудования и известных
методов.
Однако технологии шифрования редко обеспечивают настолько надежную
защиту. Многие реализации технологий шифрования обладают одной или несколькими из
указанных ниже уязвимостей.
 Изъян в алгоритме шифрования. В алгоритмах шифрования иногда
обнаруживаются фундаментальные изъяны — после экспертной оценки или успешной
атаки. В некоторых случаях подобные изъяны обнаруживаются спустя несколько лет
после публикации алгоритма и его широкого распространения.
 Неправильная реализация. Алгоритмы реализуются конкретными
разработчиками и иногда содержат ошибки, снижающие эффективность алгоритма.
 Ключи имеют низкий уровень энтропии. Если пространство ключей имеет
размер, например, 128 бит, это еще не означает, что при создании 128-разрядного ключа
используются подлинно случайные числа или все пространство ключей.
 Ключи легко вскрываются. Ключи необходимо где-то хранить. Если это
местоположение можно обнаружить и получить ключ, можно вскрыть зашифрованные
данные.

Проверка и тестирование стойкости реализации алгоритмов шифрования
позволяет значительно снизить вероятность возникновения подобных уязвимостей. Этот
процесс начинается с выбора проверенных и признанных алгоритмов, имеющих
встроенную устойчивость к некоторым типам атак. Кроме того, не будет лишней
сертификация реализации алгоритмов шифрования.
При оценке технологии шифрования важно учитывать приведенные ниже
факторы.
 Выбор алгоритма. Безопасность реализации алгоритма шифрования зависит как
от качества реализации, так и от реализуемого алгоритма. По этой причине в большинстве
коммерческих технологий реализовано относительно небольшое число проверенных и


хорошо протестированных алгоритмов, которые считаются безопасными при различных
типах атак. Примерами таких алгоритмов являются 3DES, AES и Blowfish, которые
являются алгоритмами симметричного шифрования, RSA и Elliptic Curves Ciphering
(ECC), которые являются алгоритмами (или семейством алгоритмов, в случае с ECC) на
основе открытых ключей.
 Создание ключей. Технологии шифрования зачастую используют несколько
ключей. Некоторые из этих ключей создаются оборудованием или программным
обеспечением, некоторые предоставляются людьми, а некоторые создаются на основе
ранее созданных ключей, ключей, предоставленных людьми, или их сочетания. Стойкость
созданных ключей зависит от возможности предсказать значение ключа при знании
внешних факторов. Другими словами, эффективный ключ должен быть в достаточной
степени случайным и иметь достаточную длину.
 Производные ключи. Во многих реализациях ключи создаются на основе других
ключей, например на основе пароля пользователя. Процесс создания каждого из ключей
критически важен для общего уровня безопасности реализации. Важно иметь в виду, что
созданные ключи не могут быть более стойкими, чем исходные. Можно создать 256-
разрядный ключ AES на основе 56-разрядного ключа DES, но созданный ключа не будет
более стойким, чем 56-разрядный ключ DES, который, в свою очередь, может быть
получен на основе еще менее стойкого ключа.
 Хранилище ключей. Каждая технология шифрования должна хранить и
использовать данные ключа. Способ хранения данных ключа критически важен для
общего уровня безопасности реализации. Ценные данные, такие как ключи подписи
корневого центра сертификации, зачастую защищены устойчивыми к взлому
аппаратными модулями, обеспечивающими надежную защиту от атаки. Многие
организации используют смарт-карты, поскольку они обеспечивают более высокий
уровень безопасности хранилища ключей, чем программные решения. Дополнительным
преимуществом смарт-карт является то, что пользователь не может (в том числе
непреднамеренно) восстановить и раскрыть данные ключа смарт-карты. Также
необходимо обеспечить правильное поведение пользователя, в том числе надлежащую
защиту данных ключа и паролей. Технологии шифрования, требования которых
пользователю проще соблюдать, значительно более безопасны и эффективны.
 Кэширование ключей. Криптографические операции зачастую имеют высокую
вычислительную сложность. Для повышения производительности технологии
шифрования зачастую используют способы оптимизации, включающие кэширование


ключей или промежуточные результаты криптографических операций. Подобные данные
являются конфиденциальными, и если технология не обеспечивает их надлежащую
защиту, они могут стать доступны злоумышленнику. Например, технология, кэширующая
ключ шифрования в памяти, может позволить злоумышленнику восстановить его из
системной памяти или файла подкачки, если кэш неправильно реализован и не защищен.
 Самое слабое звено. Общий уровень безопасности реализации алгоритма
шифрования зависит от безопасности самого слабого звена. В силу этого выявление
самого слабого звена в любой технологии шифрования является наиболее важным
аспектом при оценке реализации алгоритма шифрования. Во многих средах самым
слабым звеном являются пользователи, поэтому критически важно принять технические
меры защиты данных на мобильных ПК, а также провести соответствующее обучение
пользователей.
 Баланс удобства использования и безопасности. Фактически ни одно решение для
шифрования не является идеальным. Все решения подвержены атакам методом перебора
— проблема заключается только в том, сколько времени займет подобная атака.
Эффективные реализации более или менее эквивалентны по стойкости лежащей в их
основе технологии шифрования. Однако криптографическая стойкость зачастую не
является самым важным фактором. Также очень важны другие факторы, например
взаимодействие с пользователями. Меры безопасности почти всегда можно повышать до
тех пор, пока доступ к данным для пользователей не станет слишком сложным, но степень
сложности необходимо тщательно проанализировать, чтобы определить ее приемлемость
для организации. Не следует внедрять решение, которое настолько сложно в
использовании, что пользователи предпочтут ему бумагу и карандаш.

3. **Криптографическая защита жестких дисков и съемных носителей**
КриптоПро
КриптоПро – это ряд программного обеспечения от российского производителя,
компании КриптоПро. Для криптографической защиты данных на жестких дисках и
съемных носителях предназначена программа КриптоПро EFS.
ПО "КриптоПро EFS" предназначенo для обеспечения защиты конфиденциальной
информации при ее хранении на ПЭВМ.
КриптоПро EFS полностью поддерживает интерфейс, предложенный Microsoft для
шифрующей файловой системы ОС Windows. Работа с защищенными файлами не требует
изменений в пользовательских приложениях, поддерживаются интерфейсы для


шифрования, расшифрования файлов и папок, редактирования группы пользователей
защищенных файлов, предлагаемых в ОС Windows.
При использовании совместно с "КриптоПро CSP", "КриптоПро EFS"
обеспечивает:

 конфиденциальность информации хранящейся на компьютере шифрованием
файлов файловой системы NTFS по алгоритму ГОСТ 28147 89;
 контроль целостности информации хранящейся на компьютере
вычислением имитовставки в соответствии с ГОСТ 28147 89;
 организацию совместного доступа к данным зашифрованного файла
ограниченной группе пользователей;
 организацию удаленной работы с защищенными файлами, размещаемыми в
Web-папках (Web Distributed Authoring and Versioning - распределенная система
хранения файлов с доступом через Web или WebDAV);
 возможность удаленной работы с зашифрованными файлами пользователей,
использующих Terminal Services для удаленного входа в систему.
 восстановление данных в случае удаления пользователей из системы,
компрометации или утраты закрытого ключа пользователя.
Основные отличия КриптоПро EFS от встроенного в ОС Windows EFS:
 КриптоПро EFS использует российские стандарты криптографической
защиты данных.
 КриптоПро EFS обеспечивает контроль целостности файлов.
 КриптоПро EFS предоставляет пользователю интерфейс для выбора
текущего ключа шифрования, ключа, по умолчанию используемого для шифрования
файлов.
 КриптоПро EFS позволяет одновременно администрировать произвольное
множество защищенных файлов. Проверять целостность множества файлов,
производить одновременное перешифрование многих файлов.
КриптоПро EFS использует сертифицированное ФСБ России средство
криптографической защиты.

BestCrypt Volume Encryption
Утилита BestCrypt Volume Encryption предназначена для шифрования целых
логических разделов. Программа является коммерческой ($99.50).


```
Рисунок 18 – Главное окно программы BestCrypt Volume Encryption
```
Зашифровывать она может не только отдельные разделы жестких дисков или
мобильных накопителей наподобие флеш-дисков, но и различные распределенные тома:
простые распределенные (spanned volumes), зеркальные (mirrored volumes), чередующиеся
(striped volumes) и тома RAID-5. Эта особенность позволяет использовать
рассматриваемую программу для защиты коммерческих данных, размещенных на
серверах.
Программа использует для защиты данных следующие алгоритмы: AES (длина
ключа 256 бит), Blowfish (448 бит), CAST (128 бит), RC6 (256 бит), Serpent (256 бит),
Twofish (256 бит) и ГОСТ 28147-89 (256 бит). Все они считаются надежными и
всесторонне исследованными. А для генерации ключа шифрования применяются действия
самого пользователя: хаотичные нажатия на кнопки клавиатуры и беспорядочные
движения мышью. Такой подход считается сегодня оптимальным, поскольку полностью
устраняет зависимость надежности системы защиты от качества генератора случайных
чисел.


```
Рисунок 19 – Шифрование раздела жесткого диска
```
Сам ключ шифрования по умолчанию хранится на жестком диске компьютера, а
доступ к нему ограничивается с помощью парольной защиты. Даже введенное
разработчиками ограничение на минимальную длину ключевого слова (восемь символов)
не оказывает существенного влияния на надежность. К счастью, в программе
предусмотрено решение этой проблемы. Дело в том, что в ней реализована поддержка
аппаратных USB-ключей Aladdin eToken. При их использовании ключи шифрования
сохраняются в защищенной памяти токена, извлечь данные откуда можно, только зная
PIN-код. Аппаратный ключ хорошо защищен от взлома, а поэтому является гораздо более
надежным, нежели обычная парольная защита.
В рассматриваемом продукте реализована поддержка режима шифрования LRW.
Эта технология используется для криптографического преобразования целых разделов
жестких дисков. Она обеспечивает большую устойчивость защиты перед некоторыми
видами атак. При работе в режиме LRW дополнительно к ключу шифрования,
предусмотренному алгоритмом, используется еще один, длина которого равна размеру
блоков данных, использующихся в этом алгоритме. Таким образом, можно сказать, что
общая длина ключа шифрования увеличивается, что, естественно, сказывается на степени
надежности защиты.
BestCrypt Volume Encryption имеет возможность шифрования системного раздела
жесткого диска. Она позволяет решить пользователям сразу же несколько серьезных
проблем. Начать нужно с того, что загрузить операционную систему можно будет, только
зная пароль зашифрованного диска. То есть фактически речь идет о надежной защите от


несанкционированного запуска компьютера. Причем, что весьма интересно, пользователь
может выбрать так называемую тему, то есть надписи, которые будут выдаваться при
включении ПК и неправильном вводе пароля. Изначально в программе реализовано шесть
тем. Причем две из них имитируют различные ошибки, возникающие при крушении
операционной системы, а еще одна — остановившийся процесс загрузки Windows. При их
использовании у человека, не знающего об установленной защите, возникает впечатление
сбоя в работе компьютера, что является дополнительной защитой. Кроме того, владелец
ПК может самостоятельно создать любую тему.
Следующей возможностью программы BestCrypt Volume Encryption является
поддержка сетевой работы. Если на диске перед шифрованием были папки с общим
доступом, то после их открытия все разрешения восстанавливаются. Это позволяет
использовать рассматриваемый продукт для защиты любой информации на сервере:
документов, баз данных и того подобного.
Следует упомянуть и о возможностях восстановления данных в случае
возникновения каких-либо проблем с носителями. Такая ситуация вполне возможна —
жесткие диски являются одним из наиболее часто выходящих из строя элементов
компьютера. Разработчики рассматриваемой утилиты предусмотрели это и реализовали
функцию восстановления зашифрованных дисков. Работает она следующим образом.
Пользователь с помощью особого пункта меню создает файл, содержащий специальную
информацию, и копирует его на любой другой носитель. В будущем при возникновении
каких-то сбоев он может скопировать его обратно и попытаться восстановить
поврежденную информацию. Гарантии успеха нет, однако шансы уменьшить последствия
аварии – есть. Кроме того, в программе BestCrypt Volume Encryption существует
возможность восстановления информации с поврежденных системных разделов.
Поскольку в этом случае загрузка операционной системы невозможна, для этого
используется специальная загрузочная дискета, CD- или DVD-диск, которые можно
заранее создать из меню утилиты.
В целом, BestCrypt Volume Encryption хорошо подходит для корпоративного
использования. Она не обладает полным функционалом дорогостоящих аналогов, но
обеспечивает надежную защиту конфиденциальной информации при относительно
небольшой цене [15].


4. **Создание секретных дисков**

Программа TrueCrypt позволяет создавать полностью зашифрованный
виртуальный диск, на котором после начального ввода пароля доступа данные будут
автоматически зашифровываться и расшифровываться без внешнего вмешательства.
Защищенный виртуальный диск создается в виде файла, который можно
скопировать на любой компьютер и смонтировать, введя пароль. Формат файла вы в
процессе создания зашифрованного диска можете выбрать сами в зависимости от
необходимого вам размера диска.
Еще одно достоинство данной программы в том, что ни один диск TrueCrypt не
может быть аутентифицирован. Защищенный диск, созданный с помощью TrueCrypt,
невозможно отличить от набора случайных данных, то есть файл нельзя связать с
TrueCrypt как с программой, его создавшей.
Дополнительно внутри данного диска (в терминологии TrueCrypt – внешнего
тома) можно создать так называемый скрытый диск размером меньше оригинала
(скрытый том). Таким образом во внешнем томе можно разместить файлы, которые не
содержат конфиденциальной информации, а на скрытом томе - конфиденциальную
информацию. В случае монтирования внешнего тома скрытый том с конфиденциальными
файлами остается невидим.

5. **Средства шифрования, встроенные в операционную систему Windows**

В данном разделе будут рассмотрены две технологии — шифрованная файловая
система (EFS) и шифрование диска Microsoft® BitLocker™ (BitLocker), — являются
примерами двух различных, но взаимодополняющих подходов к шифрованию данных.
Файловая система EFS — это механизм шифрования, защищающий данные в файлах и
папках каждого пользователя. BitLocker — это механизм шифрования всего тома,
шифрующий все секторы на системном томе компьютера, в том числе операционную
систему, приложения и файлы данных. Технология BitLocker обеспечивает проверку
целостности и шифрование до загрузки операционной системы, но не позволяет
выполнять проверку подлинности пользователя. Файловая система EFS дополняет
возможности технологии BitLocker, предоставляя доступ к зашифрованным файлам


только пользователям, прошедшим надлежащим образом проверку на работающем
компьютере.
Вследствие фундаментально различных подходов и методов реализации
технологии EFS и BitLocker обладают собственными достоинствами и недостатками и
обеспечивают разные уровни безопасности в случае распространенных атак
злоумышленников.

EFS **и** Windows XP/Vista
Операционные системы Microsoft® Windows® XP и Windows Vista™ позволяют
защищать данные и восстанавливать их с помощью шифрованной файловой системы
(EFS). Файловая система EFS — это технология шифрования данных, применяемая к
отдельным файлам или всем файлам в конкретной папке. Файлы EFS невозможно
расшифровать без соответствующих данных ключа. Кроме того, необходимо отметить,
что, в отличие от технологии шифрования диска Microsoft BitLocker™ (BitLocker),
файловую систему EFS нельзя применять к файлам, необходимым для загрузки
операционной системы.
Хотя технология BitLocker обеспечивает шифрование всех данных на системном
томе, файловая система EFS обеспечивает большую точность и гибкость при настройке
параметров шифрования для одного или нескольких пользователей компьютера.
Например, файловую систему EFS можно использовать для шифрования файлов данных в
сети, доступ к которым имеет множество различных пользователей, что невозможно
сделать с помощью технологии BitLocker.
Файловая система EFS шифрует данные каждого пользователя с помощью ключа,
доступного только самому пользователю и авторизованным агентам восстановления.
Злоумышленник, получивший копии файлов, не сможет их прочитать, пока не получит
данные ключа или не скопирует файлы напрямую из исходного местоположения в другое,
используя учетную запись пользователя, который зашифровал файлы.
Подсистема EFS использует различные симметричные алгоритмы шифрования,
зависящие от версии используемой операционной системы windows NT.
Таблица 4 – алгоритмы шифрования, используемые в шифрованной файловой
системе

**Операционная
система**

```
Алгоритм
шифрования по
умолчанию
```
```
Альтернативные
доступные алгоритмы
Windows 2000 DESX (none)
Windows XP RTM DESX 3DES
```

Windows XP SP1 AES 3DES, DESX
Windows Server 2003 AES 3DES, DESX
Windows Vista AES 3DES, DESX
Windows 7 AES 3DES, DESX
Windows Server 2008 AES 3DES, DESX
Режим EFS с программным хранилищем ключей
Для использования этого режима EFS требуется только компьютер с Windows XP
или Windows Vista.
Логическая последовательность процесса шифрования EFS в данном режиме
показана на рисунке 5.1.

```
Рисунок 5.1 – Процесс шифрования EFS
```
1. Пользователь создает файл в зашифрованной папке.
2. Случайным образом создается симметричный ключ шифрования файлов.
3. Операционная система проверяет хранилище сертификатов пользователя на
наличие сертификата, имеющего соответствующие флаги использования ключа. Если
такой сертификат отсутствует, он создается автоматически.
4. Для шифрования и хранения закрытого ключа, связанного с сертификатом
пользователя, используется интерфейс DPAPI.
5. Ключ шифрования файлов шифруется с помощью открытого ключа сертификата
и хранится в метаданных файла.
6. Ключ шифрования файлов используется для шифрования каждого блока данных.


7. Зашифрованные блоки записываются на диск.
Логическая последовательность процесса расшифровки EFS в данном режиме
показана на рисунке 5.2.

Рисунок 5.2 – Процесс расшифровки EFS

1. Учетные данные пользователя для входа в систему проверяется либо локально,
либо контроллером домена.
2. Пользователь пытается получить доступ к зашифрованному файлу.
3. Интерфейс DPAPI используется для загрузки закрытого ключа, связанного с
сертификатом пользователя X.509. Этот ключ расшифровывается с помощью ключа,
полученного на основе учетных данных пользователя.
4. Ключ шифрования файлов загружается из файла и расшифровывается с
помощью закрытого ключа, полученного на предыдущем этапе.
5. Ключ шифрования файлов используется для расшифровки каждого блока файла
при его запросе.
6. Расшифрованные данные передаются запросившему их приложению.
Режим EFS с использованием смарт - карт
Различные версии Windows предоставляют различные возможности для улучшения
функций безопасности файловой системы EFS.
Вход со смарт-картой — это параметр пользователя домена, настраиваемый с
помощью службы каталогов Active Directory®, который требует от пользователя
использовать смарт-карту для входа с учетной записью домена. Основной риск для
файловой системы EFS заключается в том, что в случае раскрытия пароля пользователя
злоумышленник сможет войти в систему с этой учетной записью и получить доступ к
любым данным на компьютере, в том числе к данным, защищенным с помощью EFS.


Параметр политики Active Directory, требующий смарт-карту для входа в систему,
значительно повышает безопасность учетной записи, а следовательно, безопасность
данных, защищенных с помощью EFS. Этот параметр также позволяет защитить
зашифрованные данные от автономных атак, поскольку он повышает стойкость ключа,
используемого EFS для шифрования DPAPI. DPAPI создает ключ на основе учетных
данных пользователя.
Существует два варианта требования входа в систему с помощью смарт-карт: для
каждого пользователя и для каждого компьютера. В каждом режиме можно включить или
принудительно использовать такой вход в систему. Между этими режимами имеется ряд
важных отличий в плане безопасности; часть из них приведена ниже.
 При принудительном входе в систему с помощью смарт-карт для каждого
пользователя исходный ключ имеет значительно большую стойкость, чем обычный
пароль. Вместо подбора пароля перебором по словарю злоумышленнику потребуется
методом перебора определить закрытый ключ, который при достаточной длине
практически невозможно взломать, используя современные технологии.
 Принудительный вход в систему с помощью смарт-карт для каждого компьютера
в некотором роде обеспечивает большую безопасность, чем вход в систему с помощью
только одного пароля, поскольку при этом используется дополнительный фактор
проверки подлинности. Однако при входе в систему с помощью смарт-карт для каждого
компьютера смарт-карты используются только для проверки подлинности при входе в
систему. Злоумышленник, получивший зашифрованный главный ключ DPAPI, сможет
выполнить перебор за меньшее время, чем потребуется для перебора главного ключа
DPAPI, защищенного смарт-картой для входа в систему каждого пользователя.
Включение каждого режима входа в систему с помощью смарт-карт без их
принудительного использования не является эффективной мерой обеспечения
безопасности, поскольку при этом пользователь может не использовать смарт-карту.
Процесс шифрования EFS с использованием смарт-карт в Windows XP показан на
рисунке 5.3.


```
Рисунок 5.3 – Последовательность шифрования EFS с использованием смарт-карт для
Windows XP
```
1. Пользователь создает файл в зашифрованной папке.
2. Случайным образом создается симметричный ключ шифрования файлов.
3. Операционная система проверяет хранилище сертификатов пользователя на
наличие сертификата, имеющего соответствующие флаги использования ключа. Если
такой сертификат отсутствует, он создается автоматически.
4. Для шифрования и хранения закрытого ключа, связанного с сертификатом
пользователя, используется интерфейс DPAPI. Такое шифрование является более стойким,
чем используемое в предыдущем режиме, поскольку при принудительном входе в систему
с помощью смарт-карт применяется значительно более надежный пароль.
5. Ключ шифрования файлов шифруется с помощью открытого ключа сертификата
и хранится в метаданных файла.
6. Ключ шифрования файлов используется для шифрования каждого блока данных.
7. Зашифрованные блоки записываются на диск.
Процесс расшифровки EFS с использованием смарт-карт в Windows XP показан на
рисунке 5.4.


```
Рисунок 5.4 – Последовательность расшифровки EFS с использованием смарт-карт для
Windows XP
```
1. Учетные данные пользователя для входа в систему с использованием смарт-карт
проверяется либо локально, либо контроллером домена.
2. Пользователь пытается получить доступ к зашифрованному файлу.
3. Правильный закрытый ключ загружается из хранилища DPAPI пользователя, а
DPAPI расшифровывает его с помощью ключа, полученного на основе надежного
случайного пароля пользователя, применяемого к учетной записи пользователя при
включенном параметре «Вход со смарт-картой».
4. Ключ шифрования файлов загружается из файла и расшифровывается с
помощью закрытого ключа, полученного на предыдущем этапе.
5. По мере считывания приложением каждого блока файла он расшифровывается с
помощью ключа шифрования файлов, а затем передается запросившему его приложению.
Сводный анализ рисков
В таблице 2 содержатся данные о рисках и различных режимах EFS, которые
позволяют снизить каждый из них. Для компьютеров с Windows XP включен параметр
пользователей домена Вход со смарт-картой. Для компьютеров с Windows Vista включены
параметры EFS Требовать смарт-карту для EFS и Включить шифрование файла подкачки.


Риски, которые можно снизить при использовании определенных режимов,
помечены словом Да. Тире (—) обозначают риски, которые нельзя существенно снизить с
помощью соответствующего режима.
Таблица 5 – Снижение рисков EFS

```
Риск Windows XP EFS Windows Vista EFS
```
```
Windows
XP EFS
со смарт -
картой
```
```
Windows
Vista EFS
со смарт -
картой
(cached
mode)
```
Windows
Vista EFS **со
смарт** -